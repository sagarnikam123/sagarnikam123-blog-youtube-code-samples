# Fluent Bit Configuration - Loki Canary Log Collection
# Collects Loki Canary logs for monitoring and health checks
# Reference: https://docs.fluentbit.io/manual/pipeline/inputs/tail

[SERVICE]
    flush                               1
    HTTP_Server                         On
    HTTP_Listen                         0.0.0.0
    HTTP_PORT                           2020
    Log_Level                           warn
    storage.Path                        ${HOME}/data/fluent-bit/flb-storage/
    storage.max_chunks_up               128
    storage.metrics                     on
    storage.delete_irrecoverable_chunks On

[INPUT]
    Name                                tail
    Tag                                 loki-canary
    Path                                ${HOME}/data/loki-canary/*.log
    DB                                  ${HOME}/data/fluent-bit/fluent-bit-loki.db
    Refresh_Interval                    10
    storage.type                        filesystem
    Read_from_Head                      On
    Skip_Empty_Lines                    On

# Debug output (uncomment for troubleshooting)
#[OUTPUT]
#    Name                                stdout
#    Match                               *
#    storage.total_limit_size            5M

[OUTPUT]
    name                                loki
    match                               loki-canary
    host                                127.0.0.1
    port                                3100
    labels                              name=loki-canary,stream=stdout
    drop_single_key                     raw
    storage.total_limit_size            5M
