# Development Environment Values
# Aligned with scnx-dts01-eks configuration
#
# Usage:
#   helm install prometheus prometheus-community/kube-prometheus-stack \
#     -n prometheus --create-namespace \
#     -f base/values.yaml \
#     -f versions/v3.5.0-lts/values.yaml \
#     -f environments/dev/values.yaml \
#     --timeout 15m

# Common tolerations - use YAML anchor for reuse
_tolerations: &common_tolerations
  - key: app-support
    operator: Equal
    value: multi-platform-all
    effect: NoSchedule

prometheus:
  prometheusSpec:
    # Scrape settings (aligned with dts01-eks)
    scrapeInterval: 5m
    scrapeTimeout: 1m
    evaluationInterval: 1m

    # Route prefix for /prometheus path
    routePrefix: /prometheus
    externalUrl: https://scnx-global-dev-aps1-eks.securonix.net/prometheus

    # External labels for identification
    externalLabels:
      environment: global-dev-aps1

    # Enable native histograms
    enableFeatures:
      - native-histograms

    # OTLP configuration
    enableOTLPReceiver: true

    retention: 15d
    tolerations: *common_tolerations
    resources:
      requests:
        cpu: 2
        memory: 4Gi
      limits:
        cpu: 4
        memory: 8Gi
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp3
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi

  # Ingress configuration (using nginx-internal like other services)
  ingress:
    enabled: true
    ingressClassName: nginx-internal
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "false"
    hosts:
      - scnx-global-dev-aps1-eks.securonix.net
    paths:
      - /prometheus

alertmanager:
  alertmanagerSpec:
    retention: 120h
    tolerations: *common_tolerations
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 200m
        memory: 512Mi

grafana:
  adminPassword: prom-operator
  tolerations: *common_tolerations

  # Serve Grafana under /grafana path
  grafana.ini:
    server:
      root_url: https://scnx-global-dev-aps1-eks.securonix.net/grafana
      serve_from_sub_path: true

  # Ingress for Grafana
  ingress:
    enabled: true
    ingressClassName: nginx-internal
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "false"
    hosts:
      - scnx-global-dev-aps1-eks.securonix.net
    path: /grafana

  persistence:
    enabled: true
    storageClassName: gp3
    size: 10Gi
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

prometheusOperator:
  tolerations: *common_tolerations

kube-state-metrics:
  enabled: false
  tolerations: *common_tolerations

prometheus-node-exporter:
  tolerations: *common_tolerations

thanosRuler:
  thanosRulerSpec:
    tolerations: *common_tolerations

# Disable Kubernetes component scraping for dev
kubeEtcd:
  enabled: false
kubeControllerManager:
  enabled: false
kubeScheduler:
  enabled: false
kubeProxy:
  enabled: false
kubeApiServer:
  enabled: false
coreDns:
  enabled: false
kubelet:
  enabled: false
