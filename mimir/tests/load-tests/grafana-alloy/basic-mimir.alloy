// Basic Grafana Alloy configuration for Mimir
// Scrapes local metrics and sends to Mimir

// Scrape Alloy's own metrics
prometheus.scrape "alloy" {
  targets = [
    {"__address__" = "localhost:12345"},
  ]
  forward_to = [prometheus.remote_write.mimir.receiver]
}

// Remote write to Mimir
prometheus.remote_write "mimir" {
  endpoint {
    url = "http://mimir-gateway.mimir-test.svc.cluster.local/api/v1/push"

    headers = {
      "X-Scope-OrgID" = "demo",
    }

    queue_config {
      capacity             = 10000
      max_shards           = 10
      min_shards           = 1
      max_samples_per_send = 2000
      batch_send_deadline  = "5s"
    }
  }
}
