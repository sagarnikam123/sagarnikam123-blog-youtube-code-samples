apiVersion: v1
items:
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
    labels:
      app.kubernetes.io/component: alertmanager
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
    name: mimir-alertmanager
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: alertmanager
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
    serviceName: mimir-alertmanager
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: alertmanager
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=alertmanager
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          - -server.http-idle-timeout=6m
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: alertmanager
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 45
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 10m
              memory: 32Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /configs/
            name: alertmanager-fallback-config
          - mountPath: /tmp
            name: tmp
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 900
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: alertmanager
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: tmp
        - emptyDir: {}
          name: active-queries
        - configMap:
            defaultMode: 420
            name: mimir-alertmanager-fallback-config
          name: alertmanager-fallback-config
    updateStrategy:
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 1Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-alertmanager-bf957c9c9
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-alertmanager-bf957c9c9
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
    labels:
      app.kubernetes.io/component: compactor
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
    name: mimir-compactor
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: compactor
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
    serviceName: mimir-compactor
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: compactor
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=compactor
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: compactor
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 900
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: compactor
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: active-queries
    updateStrategy:
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-compactor-796b9d7894
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-compactor-796b9d7894
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      grafana.com/prepare-downscale-http-path: ingester/prepare-shutdown
      grafana.com/prepare-downscale-http-port: "8080"
      rollout-max-unavailable: "50"
    labels:
      app.kubernetes.io/component: ingester
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
      grafana.com/min-time-between-zones-downscale: 12h
      grafana.com/prepare-downscale: "true"
      name: ingester-zone-a
      rollout-group: ingester
      zone: zone-a
    name: mimir-ingester-zone-a
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: Parallel
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: ingester
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
        rollout-group: ingester
        zone: zone-a
    serviceName: mimir-ingester-headless
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: ingester
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
          name: ingester-zone-a
          rollout-group: ingester
          zone: zone-a
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=ingester
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          - -ingester.ring.instance-availability-zone=zone-a
          - -memberlist.abort-if-fast-join-fails=true
          env:
          - name: GOMAXPROCS
            value: "4"
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: ingester
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 1200
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: ingester
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: active-queries
    updateStrategy:
      type: OnDelete
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-ingester-zone-a-85fd596474
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-ingester-zone-a-85fd596474
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      grafana.com/prepare-downscale-http-path: ingester/prepare-shutdown
      grafana.com/prepare-downscale-http-port: "8080"
      grafana.com/rollout-downscale-leader: mimir-ingester-zone-a
      rollout-max-unavailable: "50"
    labels:
      app.kubernetes.io/component: ingester
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
      grafana.com/min-time-between-zones-downscale: 12h
      grafana.com/prepare-downscale: "true"
      name: ingester-zone-b
      rollout-group: ingester
      zone: zone-b
    name: mimir-ingester-zone-b
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: Parallel
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: ingester
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
        rollout-group: ingester
        zone: zone-b
    serviceName: mimir-ingester-headless
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: ingester
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
          name: ingester-zone-b
          rollout-group: ingester
          zone: zone-b
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=ingester
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          - -ingester.ring.instance-availability-zone=zone-b
          - -memberlist.abort-if-fast-join-fails=true
          env:
          - name: GOMAXPROCS
            value: "4"
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: ingester
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 1200
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: ingester
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: active-queries
    updateStrategy:
      type: OnDelete
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-ingester-zone-b-8497c86449
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-ingester-zone-b-8497c86449
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      grafana.com/prepare-downscale-http-path: ingester/prepare-shutdown
      grafana.com/prepare-downscale-http-port: "8080"
      grafana.com/rollout-downscale-leader: mimir-ingester-zone-b
      rollout-max-unavailable: "50"
    labels:
      app.kubernetes.io/component: ingester
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
      grafana.com/min-time-between-zones-downscale: 12h
      grafana.com/prepare-downscale: "true"
      name: ingester-zone-c
      rollout-group: ingester
      zone: zone-c
    name: mimir-ingester-zone-c
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: Parallel
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: ingester
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
        rollout-group: ingester
        zone: zone-c
    serviceName: mimir-ingester-headless
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: ingester
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
          name: ingester-zone-c
          rollout-group: ingester
          zone: zone-c
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=ingester
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          - -ingester.ring.instance-availability-zone=zone-c
          - -memberlist.abort-if-fast-join-fails=true
          env:
          - name: GOMAXPROCS
            value: "4"
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: ingester
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 1200
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: ingester
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: active-queries
    updateStrategy:
      type: OnDelete
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-ingester-zone-c-74958bb47b
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-ingester-zone-c-74958bb47b
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
    labels:
      app.kubernetes.io/component: kafka
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
    name: mimir-kafka
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: kafka
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
    serviceName: mimir-kafka-headless
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: kafka
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
        namespace: mimir-test
      spec:
        containers:
        - env:
          - name: _POD_NAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.name
          - name: KAFKA_CLUSTER_ID
            value: mimir-kafka-cluster
          - name: KAFKA_NODE_ID
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.annotations['apps.kubernetes.io/pod-index']
          - name: KAFKA_PROCESS_ROLES
            value: broker,controller
          - name: KAFKA_LISTENERS
            value: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
          - name: KAFKA_ADVERTISED_LISTENERS
            value: PLAINTEXT://$(_POD_NAME).mimir-kafka-headless.mimir-test.svc.cluster.local.:9092
          - name: KAFKA_CONTROLLER_QUORUM_VOTERS
            value: 0@mimir-kafka-0.mimir-kafka-headless.mimir-test.svc.cluster.local:9093
          - name: KAFKA_CONTROLLER_LISTENER_NAMES
            value: CONTROLLER
          - name: KAFKA_INTER_BROKER_LISTENER_NAME
            value: PLAINTEXT
          - name: KAFKA_LOG_DIRS
            value: /var/lib/kafka/data
          - name: KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR
            value: "1"
          - name: KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR
            value: "1"
          - name: KAFKA_TRANSACTION_STATE_LOG_MIN_ISR
            value: "1"
          - name: KAFKA_LOG_RETENTION_HOURS
            value: "24"
          image: apache/kafka-native:4.1.0
          imagePullPolicy: IfNotPresent
          name: kafka
          ports:
          - containerPort: 9092
            name: kafka
            protocol: TCP
          - containerPort: 9093
            name: controller
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 5
            successThreshold: 1
            tcpSocket:
              port: kafka
            timeoutSeconds: 5
          resources:
            requests:
              cpu: "1"
              memory: 1Gi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/lib/kafka
            name: kafka-data
          - mountPath: /opt/kafka/config
            name: kafka-config
          - mountPath: /tmp
            name: tmp
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: kafka-config
        - emptyDir: {}
          name: tmp
    updateStrategy:
      rollingUpdate:
        partition: 0
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: kafka-data
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 5Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-kafka-798668fb46
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-kafka-798668fb46
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      grafana.com/prepare-downscale-http-path: store-gateway/prepare-shutdown
      grafana.com/prepare-downscale-http-port: "8080"
      rollout-max-unavailable: "50"
    labels:
      app.kubernetes.io/component: store-gateway
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
      grafana.com/min-time-between-zones-downscale: 30m
      grafana.com/prepare-downscale: "true"
      name: store-gateway-zone-a
      rollout-group: store-gateway
      zone: zone-a
    name: mimir-store-gateway-zone-a
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: store-gateway
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
        rollout-group: store-gateway
        zone: zone-a
    serviceName: mimir-store-gateway-headless
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: store-gateway
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
          name: store-gateway-zone-a
          rollout-group: store-gateway
          zone: zone-a
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=store-gateway
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          - -store-gateway.sharding-ring.instance-availability-zone=zone-a
          - -server.grpc-max-send-msg-size-bytes=209715200
          env:
          - name: GOMAXPROCS
            value: "5"
          - name: GOMEMLIMIT
            value: "536870912"
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: store-gateway
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 120
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: store-gateway
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: active-queries
    updateStrategy:
      type: OnDelete
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-store-gateway-zone-a-6787d5d685
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-store-gateway-zone-a-6787d5d685
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      grafana.com/prepare-downscale-http-path: store-gateway/prepare-shutdown
      grafana.com/prepare-downscale-http-port: "8080"
      grafana.com/rollout-downscale-leader: mimir-store-gateway-zone-a
      rollout-max-unavailable: "50"
    labels:
      app.kubernetes.io/component: store-gateway
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
      grafana.com/min-time-between-zones-downscale: 30m
      grafana.com/prepare-downscale: "true"
      name: store-gateway-zone-b
      rollout-group: store-gateway
      zone: zone-b
    name: mimir-store-gateway-zone-b
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: store-gateway
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
        rollout-group: store-gateway
        zone: zone-b
    serviceName: mimir-store-gateway-headless
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: store-gateway
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
          name: store-gateway-zone-b
          rollout-group: store-gateway
          zone: zone-b
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=store-gateway
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          - -store-gateway.sharding-ring.instance-availability-zone=zone-b
          - -server.grpc-max-send-msg-size-bytes=209715200
          env:
          - name: GOMAXPROCS
            value: "5"
          - name: GOMEMLIMIT
            value: "536870912"
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: store-gateway
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 120
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: store-gateway
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: active-queries
    updateStrategy:
      type: OnDelete
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-store-gateway-zone-b-b474fd69b
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-store-gateway-zone-b-b474fd69b
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      grafana.com/prepare-downscale-http-path: store-gateway/prepare-shutdown
      grafana.com/prepare-downscale-http-port: "8080"
      grafana.com/rollout-downscale-leader: mimir-store-gateway-zone-b
      rollout-max-unavailable: "50"
    labels:
      app.kubernetes.io/component: store-gateway
      app.kubernetes.io/instance: mimir
      app.kubernetes.io/name: mimir
      app.kubernetes.io/part-of: memberlist
      grafana.com/min-time-between-zones-downscale: 30m
      grafana.com/prepare-downscale: "true"
      name: store-gateway-zone-c
      rollout-group: store-gateway
      zone: zone-c
    name: mimir-store-gateway-zone-c
    namespace: mimir-test
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Delete  # Production: use Retain
      whenScaled: Delete   # Production: use Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: store-gateway
        app.kubernetes.io/instance: mimir
        app.kubernetes.io/name: mimir
        rollout-group: store-gateway
        zone: zone-c
    serviceName: mimir-store-gateway-headless
    template:
      metadata:
        annotations:
        labels:
          app.kubernetes.io/component: store-gateway
          app.kubernetes.io/instance: mimir
          app.kubernetes.io/name: mimir
          app.kubernetes.io/part-of: memberlist
          name: store-gateway-zone-c
          rollout-group: store-gateway
          zone: zone-c
        namespace: mimir-test
      spec:
        containers:
        - args:
          - -target=store-gateway
          - -config.expand-env=true
          - -config.file=/etc/mimir/mimir.yaml
          - -store-gateway.sharding-ring.instance-availability-zone=zone-c
          - -server.grpc-max-send-msg-size-bytes=209715200
          env:
          - name: GOMAXPROCS
            value: "5"
          - name: GOMEMLIMIT
            value: "536870912"
          image: grafana/mimir:r368-547a06a0
          imagePullPolicy: IfNotPresent
          name: store-gateway
          ports:
          - containerPort: 8080
            name: http-metrics
            protocol: TCP
          - containerPort: 9095
            name: grpc
            protocol: TCP
          - containerPort: 7946
            name: memberlist
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /ready
              port: http-metrics
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          securityContext:
            allowPrivilegeEscalation: true
            capabilities: {}
            readOnlyRootFilesystem: false
            runAsUser: 0
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /etc/mimir
            name: config
          - mountPath: /var/mimir
            name: runtime-config
          - mountPath: /data
            name: storage
          - mountPath: /active-query-tracker
            name: active-queries
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext:
          fsGroup: 0
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
          seccompProfile:
            type: RuntimeDefault
        serviceAccount: mimir
        serviceAccountName: mimir
        terminationGracePeriodSeconds: 120
        topologySpreadConstraints:
        - labelSelector:
            matchLabels:
              app.kubernetes.io/component: store-gateway
              app.kubernetes.io/instance: mimir
              app.kubernetes.io/name: mimir
          maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
        volumes:
        - configMap:
            defaultMode: 420
            items:
            - key: mimir.yaml
              path: mimir.yaml
            name: mimir-config
          name: config
        - configMap:
            defaultMode: 420
            name: mimir-runtime
          name: runtime-config
        - emptyDir: {}
          name: active-queries
    updateStrategy:
      type: OnDelete
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: storage
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: mimir-store-gateway-zone-c-94f85684c
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
    updateRevision: mimir-store-gateway-zone-c-94f85684c
    updatedReplicas: 1
kind: List
metadata:
